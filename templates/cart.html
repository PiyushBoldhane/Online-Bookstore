{% extends "base.html" %} {% block content %}
<h2>Your Cart</h2>
<table class="cart-table">
  <tr>
    <th>Title</th>
    <th>Author</th>
    <th>Price</th>
    <th>Quantity</th>
    <th>Subtotal</th>
  </tr>
  {% for id, title, author, price, qty, subtotal in items %}
  <tr>
    <td>{{ title }}</td>
    <td>{{ author }}</td>
    <td>‚Çπ{{ price }}</td>
    <td>
      <a
        href="{{ url_for('update_quantity', book_id=id, action='decrease') }}"
        class="qty-btn"
        >-</a
      >
      {{ qty }}
      <a
        href="{{ url_for('update_quantity', book_id=id, action='increase') }}"
        class="qty-btn"
        >+</a
      >
    </td>
    <td>‚Çπ{{ subtotal }}</td>
  </tr>
  {% endfor %}
</table>

<h3>Total: ‚Çπ{{ total }}</h3>
<button type="button" class="btn" onclick="showCheckoutForm()">
  ‚úÖ Place Order
</button>

<!-- ‚úÖ Hidden Modal Form -->
<div id="checkout-modal" class="modal">
  <div class="modal-content">
    <h2>üßæ Checkout</h2>
    <form id="checkout-form" action="{{ url_for('checkout') }}" method="POST">
      <div class="form-group">
        <label for="customer_name">Name</label>
        <input type="text" name="customer_name" id="customer_name" required />
      </div>

      <div class="form-group">
        <label for="customer_email">Email</label>
        <input
          type="email"
          name="customer_email"
          id="customer_email"
          required
        />
      </div>

      <div class="form-actions">
        <button type="submit" class="btn confirm-btn">‚úÖ Confirm Order</button>
        <button
          type="button"
          class="btn cancel-btn"
          onclick="hideCheckoutForm()"
        >
          Cancel
        </button>
      </div>
    </form>
  </div>
</div>

<!-- ‚úÖ JavaScript -->
<script>
  function showCheckoutForm() {
    fetch("/cart-data")
      .then((res) => res.json())
      .then((data) => {
        if (Object.keys(data.cart).length === 0) {
          showToast(
            "üõí Your cart is empty. Add items before placing an order!",
            "error"
          );
        } else {
          document.getElementById("checkout-modal").style.display = "flex";
        }
      })
      .catch(() => {
        showToast("‚ö†Ô∏è Could not verify cart contents.", "error");
      });
  }

  function hideCheckoutForm() {
    document.getElementById("checkout-modal").style.display = "none";
  }
</script>
{% endblock %}
