<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Checkout</title>
    <link rel="stylesheet" href="/static/style.css" />
  </head>
  <body>
    <header><a href="/">‚Üê Continue browsing</a></header>
    <main>
      <h2>Checkout</h2>
      <form id="order-form">
        <label>Name <input name="name" required /></label><br />
        <label>Email <input name="email" type="email" required /></label><br />
        <button type="submit">Place order</button>
      </form>
      <div id="msg"></div>
    </main>
    <script>
      async function submitOrder(ev) {
        ev.preventDefault();
        const form = ev.target;
        const name = form.name.value.trim();
        const email = form.email.value.trim();
        const cart = JSON.parse(localStorage.getItem("cart") || "[]");
        if (cart.length === 0) {
          alert("Cart empty");
          return;
        }
        const res = await fetch("/api/place_order", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ name, email, cart }),
        });
        const j = await res.json();
        if (res.ok) {
          localStorage.removeItem("cart");
          document.getElementById("msg").textContent =
            "Order placed! ID: " + j.order_id;
        } else {
          document.getElementById("msg").textContent =
            "Error: " + (j.error || "failed");
        }
      }
      document
        .getElementById("order-form")
        .addEventListener("submit", submitOrder);
    </script>
  </body>
</html>
